# TEXT2SQL系统 2.0版本

## 🚀 版本升级

### 从1.0到2.0的重大升级
- **1.0版本**: 基础TEXT2SQL功能，支持SQLite + 业务规则管理
- **2.0版本**: 企业级数据库管理 + 多知识库系统

## 🎯 2.0版本新功能

### 1. 🗄️ 多数据库支持
- **SQLite**: 本地开发和测试
- **MSSQL**: 企业级生产环境
- **默认连接**: 10.97.34.39/FF_IDSS_Dev_FF
- **连接管理**: 可视化配置和测试

### 2. 📊 表结构管理
- **表导入**: 自动导入数据库表结构
- **表删除**: 安全删除不需要的表
- **连接测试**: 实时测试数据库连接
- **结构同步**: 自动同步表结构到知识库

### 3. 🧠 双知识库系统

#### 表结构知识库
- **表备注**: 为每个表添加业务说明
- **字段备注**: 详细描述字段含义和用途
- **关系说明**: 表间关系和约束说明
- **示例数据**: 提供字段值示例

#### 产品知识库
- **业务逻辑**: 基于FF_IDSS_Dev_FF的[group]表
- **产品规则**: 特定业务场景的查询规则
- **术语词典**: 产品相关术语解释
- **查询模板**: 常用查询的标准模板

### 4. 🛠️ 企业级管理功能
- **配置持久化**: 所有配置自动保存
- **权限管理**: 数据库访问权限控制
- **批量操作**: 支持批量导入和管理
- **备份恢复**: 知识库备份和恢复

## 📋 默认数据库配置

```
服务器: 10.97.34.39
数据库: FF_IDSS_Dev_FF
用户名: FF_User
密码: Grape!0808
驱动: ODBC Driver 17 for SQL Server
```

## 🔧 安装和使用

### 1. 环境要求
- Python 3.8+
- ODBC Driver 17 for SQL Server
- 网络访问到目标MSSQL服务器

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 启动系统
```bash
streamlit run text2sql_v2.0.py
```

## 📁 文件结构

### 配置文件
- `database_configs.json` - 数据库连接配置
- `table_knowledge.json` - 表结构知识库
- `product_knowledge.json` - 产品知识库
- `business_rules.json` - 业务规则 (继承自1.0)
- `prompt_templates.json` - 提示词模板 (继承自1.0)

### 系统文件
- `text2sql_v1.0.py` - 1.0版本备份
- `text2sql_v2.0.py` - 2.0版本主程序
- `chroma_db/` - 向量知识库存储

## 🎯 使用流程

### 1. 数据库管理
1. 进入"数据库管理"页面
2. 添加MSSQL数据库连接
3. 测试连接确保正常
4. 激活数据库用于查询

### 2. 表结构管理
1. 选择已激活的数据库
2. 导入需要的表结构
3. 为表和字段添加备注
4. 同步到知识库

### 3. 产品知识库
1. 从[group]表导入产品信息
2. 编辑产品相关业务规则
3. 添加查询模板和示例

### 4. 智能查询
1. 选择目标数据库
2. 输入自然语言问题
3. 系统结合多知识库生成SQL
4. 执行查询并展示结果

## 🔄 升级路径

### 从1.0升级到2.0
1. 备份1.0版本配置文件
2. 安装新的依赖包
3. 运行2.0版本
4. 导入1.0版本的业务规则

### 配置迁移
- 业务规则自动继承
- 提示词模板自动继承
- 需要重新配置数据库连接

## 🛡️ 安全特性

### 数据安全
- 密码加密存储
- 连接超时控制
- SQL注入防护
- 访问日志记录

### 权限控制
- 数据库级别权限
- 表级别访问控制
- 操作审计日志
- 敏感信息脱敏

## 📈 性能优化

### 连接池管理
- 数据库连接复用
- 自动连接回收
- 连接健康检查
- 负载均衡支持

### 查询优化
- SQL执行计划分析
- 慢查询监控
- 结果集缓存
- 分页查询支持

## 🔮 未来规划

### 3.0版本计划
- **更多数据库**: PostgreSQL, Oracle, MySQL
- **实时同步**: 表结构变更自动同步
- **AI训练**: 基于查询历史的模型优化
- **可视化**: 数据关系图和ER图生成

### 企业功能
- **多租户**: 支持多组织隔离
- **API接口**: RESTful API支持
- **集成能力**: 与BI工具集成
- **监控告警**: 系统健康监控

---

**TEXT2SQL 2.0 - 让数据查询更智能，让企业数据更有价值！** 🚀