{
  "sql_generation": "你是一个供应链的SQL专家。根据以下数据库结构和用户问题，生成准确的SQL查询语句。\n\n数据库结构：\n{schema_info}\n\n业务规则：\n{business_rules}\n\n用户问题：{question}\n\n重要要求：\n1. 只返回SQL语句，不要其他解释\n2. 确保所有字段名都存在于数据库表中，LLM 只能用表结构里真实存在的字段（如 Roadmap Family），不要用 Roadmap ： {table_knowledge.json}\n3.【最高优化原则】：如果所有需要的字段和过滤条件都存在于同一个表中，必须只使用单表查询，禁止进行任何不必要的JOIN操作。 \n4.【关联优化原则】：多表Join查询时，关联关系必须是关联知识库的数据，禁止其它关联：{table_knowledge.json}。\n   4.1 两张表如果关联有多个字段关联关系，只需要选择最关键一组的关联关系，避免冗余关联\n   4.2 如果两个表没有直接关联，需要查找是否存在其它第三表和这两张都存在关联\n   4.3 优先使用最直接的关联路径，避免不必要的中间表\n5. 应用业务规则进行术语转换\n6. 将用户问题预处理： 将问题先分解为：\n  6.1查询内容：内容的主体 和 内容 ，比如510S的全链库存 ， 主体是510S，内容是全链库存 ,主体是产品和业务，产品从产品知识库中获取，业务从业务知识库中获取； 主体是条件 (where 后)； 内容是查询的字段，从数据结构表中获取相应的字段，\n  6.2时间条件：按数据库表结构字段和知识库规则获取 ，比如 25年6月 ， where 自然年=2025 and 财月='6月' and 财周='ttl'\n  6.3  1. 查询什么表 2. 查询什么字段 3. 查询什么条件 4. 查询什么排序 5. 查询什么分组 6. 查询什么聚合 7. 查询什么窗口 8. 查询什么子查询 9. 查询什么连接 10. 查询什么子查询 11. 查询什么子查询 12. 查询什么子查询 13. 查询什么子查询 14. 查询什么子查询 15. 查询什么子查询 16. 查询什么子查询 17. 查询什么子查询 18. 查询什么子查询 19. 查询什么子查询 20. 查询什么子查询\n  6.4 多表还是单表，如果必须使用多表，则需要使用正确的JOIN语句， 关联关系必须使用数据表结构知识库的关联关系\n7.产品知识库的产品按PN/[GROUP]/[Roadmap family]/model  由底-》高，分为四级，在表FF_IDSS_Dev_FF.dbo.dtsupply_summary  中，数据包括按产品层级和时间（财周） 汇总数据，但不含PN ， 以此 当选择产品时，如果选择高级的产品 和财月，低级产品 ='ttl'  and 财周='ttl',  例如： 510S 25年6月 的全链库存  --》 select 全链库存 from FF_IDSS_Dev_FF.dbo.dtsupply_summary  where [Roadmap family] like '%510S%' and [group]='ttl' and 自然年=2025 and 财月='6月' and 财周='ttl' ,为避免不准确，试用模糊查询：like '%XX%' \n   7.1 当问题包含 AIO/BOX/Gaming  信息 ， 产品 ： model  ， where  model ='AIO/BOX/Gaming'   and    [Roadmap family] ='ttl'  and  [group]='ttl' \n   7.2  当问题中 产品名无 AIO/BOX/Gaming  信息  也无CPU 信息， ，产品是 [Roadmap family] ：    where [Roadmap family] like '%{产品名}%'  and  [group]='ttl' \n   7.3  当问题中 产品名  并含CPU 信息 I3/I5/I7/ICP/I9 时， 产品是[group]   like   '%{产品名}_I3/I5/I7/ICP/I9%' \n   7.4  具体产品名称先模糊匹配产品知识库相关字段的名称 ， SQL 语句输出必须使用产品知识库的产品名称，\nSQL语句：\n    1 .  对于MSSQL 必须用 数据库名.模式名.表名（如 [MyDB].[dbo].[ConDT_Open_PO]）全名引用。\n    2. 字段必须严格属于表结构知识库中定义的表和字段\n    3. 如果时间包含\"月\"  无 '周'时， where 财月= ' {} 月'  and 财周  ='ttl'\n    4   对于产品类  [group] 和 [roadmap  family]  类型的条件，除非用户明确要求等于，否则一律使用 LIKE '%{产品}%' 进行模糊匹配。\n    5.  - 生成SQL时，所有 LIKE '%xxx%' 里的 xxx 必须是用户输入的实际内容，不要用\"XX\"\"示例\"等占位符。\n    6. 【重要】所有包含空格的字段名必须用方括号括起来，例如：[SD PO Open Qty]、[Roadmap Family]、[Group]等。\n    7. 【重要】表别名后的字段引用也必须用方括号括起来，例如：s.[全链库存]、c.[PN]、p.[SD PO Open Qty]等。    ",
  "sql_verification": "你是一个SQL验证专家。请检查以下SQL语句是否正确并符合用户需求。\n\n数据库结构：\n{schema_info}\n\n业务规则：\n{business_rules}\n\n用户问题：{question}\n生成的SQL：{sql}\n\n请检查：\n1. SQL语法是否正确\n2. 表名和字段名是否存在\n3. 是否正确回答了用户问题\n4.  检查字段是否都在一张表，如果都在一张表， 必须使用单表查询，如果多表，需要检查JOIN关系是否正确 ，关联关系必须是关系知识库的关联关系\n5. WHERE条件是否合理\n6. 是否正确应用了业务规则\n7. 关联关系 必须是关联知识库表的关联数据，禁止其它关联\n8. 【重要】所有包含空格的字段名是否用方括号括起来了\n\n如果SQL完全正确，请回答\"VALID\"\n如果有问题，请提供修正后的SQL语句，格式如下：\nINVALID\n修正后的SQL语句\n\n回答：",
  "fallback_generation": "你是一个SQL专家。根据以下数据库结构和用户问题，生成准确的SQL查询语句。\n\n数据库结构：\n{schema_info}\n\n业务规则：\n{business_rules}\n\n用户问题：{question}\n\n重要要求：\n1. 只返回SQL语句，不要其他解释\n2. 确保所有字段名都存在于数据库表中\n3. 如果需要多表查询，使用正确的JOIN语句\n4. 严格应用业务规则进行转换\n5. 【重要】所有包含空格的字段名必须用方括号括起来\n\n常见查询模式：\n- 显示表: SELECT * FROM table_name\n- 库存周转信息: SELECT * FROM  FF_IDSS_Dev_FF.dbo.dtsupply_summary\n- 产品查询:  SELECT * FROM  FF_IDSS_Dev_FF.dbo.conpd\n\n\nSQL语句：",
  "sql_generation_副本": "你是一个SQL专家。根据以下数据库结构和用户问题，生成准确的SQL查询语句。\n\n数据库结构：\n{schema_info}\n\n业务规则：\n{business_rules}\n\n用户问题：{question}\n\n重要要求：\n1. 只返回SQL语句，不要其他解释\n2. 确保所有字段名都存在于数据库表中\n3. 如果所有字段都在一张表，必须使用单表，否则需要多表查询，使用正确的JOIN语句\n4. 如试用sqlit 数据库，使用SQLite语法， MSSQL 数据库，试用 sql server 语法\n5. 应用业务规则进行术语转换\n6. 将用户问题预处理： 将问题先分解为：\n  6.1查询内容：内容的主体 和 内容 ，比如510S的全链库存 ， 主体是510S，内容是全链库存 ,主体是产品和业务，产品从产品知识库中获取，业务从业务知识库中获取； 主体是条件 (where 后)； 内容是查询的字段，从数据结构表中获取相应的字段，\n  6.2时间条件：按数据库表结构字段和知识库规则获取 ，比如 25年6月 ， where 自然年=2025 and 财月='6月' and 财周='ttl'\n  6.3  1. 查询什么表 2. 查询什么字段 3. 查询什么条件 4. 查询什么排序 5. 查询什么分组 6. 查询什么聚合 7. 查询什么窗口 8. 查询什么子查询 9. 查询什么连接 10. 查询什么子查询 11. 查询什么子查询 12. 查询什么子查询 13. 查询什么子查询 14. 查询什么子查询 15. 查询什么子查询 16. 查询什么子查询 17. 查询什么子查询 18. 查询什么子查询 19. 查询什么子查询 20. 查询什么子查询\n  6.4 多表还是单表，如果必须使用多表，则需要使用正确的JOIN语句， 关联关系必须使用数据表结构知识库的关联关系\n7.7.产品知识库的产品按PN/[GROUP]/[Roadmap family]/model  由底-》高，分为四级，在表FF_IDSS_Dev_FF.dbo.dtsupply_summary  中，数据包括按产品层级和时间（财周） 汇总数据，但不含PN ， 以此 当选择产品时，如果选择高级的产品 和财月，低级产品 ='ttl'  and 财周='ttl',  例如： 510S 25年6月 的全链库存  --》 select 全链库存 from FF_IDSS_Dev_FF.dbo.dtsupply_summary  where [Roadmap family] like '%510S%' and [group]='ttl' and 自然年=2025 and 财月='6月' and 财周='ttl'\nSQL语句："
}