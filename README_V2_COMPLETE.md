# TEXT2SQL系统 V2.0 完整使用指南

## 🎉 V2.0版本完善完成

经过完善，TEXT2SQL V2.0版本现已具备完整的企业级功能，包括：

### ✅ 已完成的核心功能

#### 1. 🗄️ 多数据库支持
- **SQLite**: 本地开发和测试 ✅
- **MSSQL**: 企业级生产环境 ✅
- **连接管理**: 可视化配置和测试 ✅
- **连接池**: 自动管理数据库连接 ✅

#### 2. 🧠 智能SQL生成
- **自然语言理解**: 支持中文查询 ✅
- **向量检索**: ChromaDB本地知识库 ✅
- **AI生成**: DeepSeek API集成 ✅
- **SQL验证**: 智能验证和优化 ✅
- **结果可视化**: 自动生成图表 ✅

#### 3. 📊 表结构管理
- **表导入**: 自动导入数据库表结构 ✅
- **备注管理**: 表和字段备注编辑 ✅
- **知识库同步**: 自动同步到向量数据库 ✅
- **批量操作**: 支持批量导入和管理 ✅

#### 4. 🏷️ 产品知识库
- **产品信息**: 从[group]表自动导入 ✅
- **业务规则**: 产品相关查询规则 ✅
- **手动管理**: 可视化编辑界面 ✅
- **数据导出**: 支持JSON格式导出 ✅

#### 5. 📋 业务规则管理
- **术语映射**: 业务术语到数据库字段映射 ✅
- **分类管理**: 实体、字段、时间、条件映射 ✅
- **模板应用**: 预设规则模板 ✅
- **批量导入**: 支持JSON文件导入 ✅

#### 6. 📝 提示词管理
- **模板编辑**: 可视化编辑AI提示词 ✅
- **变量支持**: 动态变量插入 ✅
- **预览功能**: 实时预览模板效果 ✅
- **批量操作**: 导入导出模板 ✅

## 🚀 快速开始

### 1. 环境准备

```bash
# 安装依赖
pip install -r requirements.txt

# 检查系统
python test_v2_system.py
```

### 2. 启动系统

```bash
# 方法1: 使用启动器（推荐）
python start_text2sql.py

# 方法2: 直接启动
streamlit run text2sql_v2.0.py
```

### 3. 初始配置

1. **数据库配置**
   - 进入"数据库管理"页面
   - 添加MSSQL连接（默认已配置FF_IDSS_Dev_FF）
   - 测试连接并激活数据库

2. **表结构管理**
   - 选择已激活的数据库
   - 导入需要的表结构
   - 为表和字段添加备注
   - 批量导入到知识库

3. **产品知识库**
   - 从[group]表导入产品信息
   - 添加产品相关业务规则
   - 完善产品描述和分类

4. **业务规则**
   - 应用预设模板（教育/电商/人事）
   - 添加自定义术语映射
   - 测试规则效果

## 📋 功能详解

### 数据库管理
- **支持类型**: SQLite, MSSQL
- **连接测试**: 实时验证连接状态
- **配置持久化**: 自动保存连接配置
- **安全存储**: 密码加密存储

### SQL查询功能
- **智能生成**: 基于多知识库的SQL生成
- **执行查询**: 直接在界面执行SQL
- **结果展示**: 表格和图表可视化
- **SQL验证**: AI验证SQL正确性

### 知识库系统
- **表结构知识库**: 存储表和字段的业务含义
- **产品知识库**: 管理产品信息和业务规则
- **向量检索**: ChromaDB提供语义搜索
- **知识同步**: 自动同步到AI系统

### 企业级特性
- **配置管理**: 所有配置持久化存储
- **批量操作**: 支持批量导入和管理
- **数据导出**: JSON格式数据导出
- **模板系统**: 预设和自定义模板

## 🔧 配置说明

### 默认MSSQL配置
```
服务器: 10.97.34.39
数据库: FF_IDSS_Dev_FF
用户名: FF_User
密码: Grape!0808
驱动: ODBC Driver 17 for SQL Server
```

### API配置
```python
# config_local.py
DEEPSEEK_API_KEY = "your_api_key_here"
DEEPSEEK_MODEL = "deepseek-chat"
CHROMA_DB_PATH = "./chroma_db"
```

## 📁 文件结构

```
├── text2sql_v2.0.py          # 主程序
├── config_local.py           # 配置文件
├── start_text2sql.py         # 启动器
├── test_v2_system.py         # 测试脚本
├── database_configs.json     # 数据库配置
├── table_knowledge.json      # 表结构知识库
├── product_knowledge.json    # 产品知识库
├── business_rules.json       # 业务规则
├── prompt_templates.json     # 提示词模板
└── chroma_db/                # 向量数据库
```

## 🎯 使用场景

### 1. 企业数据查询
- 连接企业MSSQL数据库
- 使用自然语言查询业务数据
- 生成报表和分析图表

### 2. 数据库管理
- 管理多个数据库连接
- 维护表结构文档
- 建立企业数据字典

### 3. 业务知识管理
- 维护业务术语映射
- 管理产品信息
- 建立查询规则库

### 4. 团队协作
- 共享数据库配置
- 统一业务规则
- 标准化查询模板

## 🔄 从1.0升级

### 自动迁移
- ✅ 业务规则自动继承
- ✅ 提示词模板自动继承
- ✅ ChromaDB数据保留

### 需要重新配置
- 🔧 数据库连接配置
- 🔧 表结构知识库
- 🔧 产品知识库

### 升级步骤
1. 备份1.0版本配置
2. 运行V2.0系统
3. 重新配置数据库连接
4. 导入表结构和产品信息
5. 验证功能正常

## 🛡️ 安全特性

### 数据安全
- 密码加密存储
- 连接超时控制
- SQL注入防护
- 本地数据处理

### 访问控制
- 数据库级别权限
- 配置文件保护
- API密钥管理
- 操作日志记录

## 📈 性能优化

### 连接管理
- 数据库连接复用
- 自动连接回收
- 连接健康检查
- 错误重试机制

### 查询优化
- 向量检索缓存
- SQL执行优化
- 结果集分页
- 图表渲染优化

## 🔮 未来规划

### 3.0版本计划
- **更多数据库**: PostgreSQL, Oracle, MySQL
- **实时同步**: 表结构变更自动同步
- **AI训练**: 基于查询历史的模型优化
- **可视化**: 数据关系图和ER图生成

### 企业功能
- **多租户**: 支持多组织隔离
- **API接口**: RESTful API支持
- **集成能力**: 与BI工具集成
- **监控告警**: 系统健康监控

## 📞 技术支持

### 常见问题
1. **依赖安装失败**: 检查Python版本和网络连接
2. **数据库连接失败**: 验证连接参数和网络访问
3. **ChromaDB错误**: 删除chroma_db目录重新初始化
4. **API调用失败**: 检查DeepSeek API密钥

### 故障排除
```bash
# 运行系统测试
python test_v2_system.py

# 检查依赖
python start_text2sql.py

# 重置ChromaDB
python reset_chromadb.py
```

### 获取帮助
- 📖 查看详细文档
- 🔧 运行诊断脚本
- 🧪 测试系统功能
- 📝 查看日志文件

---

**TEXT2SQL V2.0 - 企业级智能数据查询系统，让数据查询更智能，让企业数据更有价值！** 🚀

## 🎊 版本特色

### 相比1.0版本的重大提升

| 功能 | 1.0版本 | 2.0版本 |
|------|---------|---------|
| 数据库支持 | 仅SQLite | SQLite + MSSQL |
| 数据库管理 | 无 | 完整的可视化管理 |
| 知识库系统 | 单一业务规则 | 双知识库系统 |
| 表结构管理 | 无 | 完整的表结构管理 |
| 产品知识库 | 无 | 基于[group]表的产品管理 |
| 配置管理 | 基础配置 | 企业级配置持久化 |
| 用户界面 | 基础界面 | 专业的企业级界面 |
| 适用场景 | 学习测试 | 企业生产环境 |

### 技术架构升级

```
V1.0: SQLite + ChromaDB + DeepSeek
V2.0: Multi-DB + Dual-Knowledge + Advanced-Management
```

V2.0版本在保持1.0版本稳定性的基础上，大幅提升了企业级应用能力，是真正可用于生产环境的TEXT2SQL解决方案。